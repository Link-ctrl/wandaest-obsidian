---
создал заметку: 21-10-2025
tags:
  - embedded
---
### Описание
Дерево устройств - это гибкий способ описать аппаратные компоненты вычислительной системы. Обычно дерево устройств загружается [[Bootloader (начальный загрузчик)]] и передается [[Linux Kernel (ядро Линукса)]], хотя можно также поставлять дерево устройств вместе с самими образом ядра, компенсируя недостатки загрузчиков, которые не умеют работать с ним отдельно.

#### Основные сведения о деревьях устройств
Дерево устройств представляет вычислительную систему в виде набора компонентов, организованных в форме древовидной иерархии. Дерево начинается с корня, представленного символом косой черты /, и расположенных под ним узлов, описывающих имеющееся в системе оборудование. У каждого узла есть имя и ряд свойств вида *имя = "значение"*, например:

```dts
/dts-v1/;

/ {
	model = "TI AM335x BeagleBone";
	compatible = "ti,am33xx";
	#address-cells = <1>;
	#size-cells = <1>;

	cpus {
		#address-cells = <1>;
		#size-cells = <0>;
		cpu@0 {
			compatible = "arm,cortex-a8";
			device_type = "cpu";
			reg = <0>;
		};
	};

	memory@0x80000000 {
		device_type = "memory";
		reg = <0x80000000 0x20000000>; /* 512 MB */
	};
};
```

#### Указатели на описатели и прерывания
Существует несколько иерархий компонентов. Помимо очевидной связи между компонентом и другими частями системы, могут существовать связи и контроллером перерываний, с генератором тактовых импульсов и с регулятором напряжения. Для выражения таких связей применяются указатели на описатели  (phandle).

```dts
/dts-v1/;

/ {
	intc: interrupt-controller@48200000 {
		compatible = "ti,am33xx-intc";
		interrupt-controller;
		#interrupt-cells = <1>;
		reg = <0x48200000 0x1000>;
	};

	serial@44e09000 {
		compatible = "ti,omap3-uart";
		ti,hwmods = "uart1";
		clock-frequency = <48000000>;
		reg = <0x44e09000 0x2000>;
		interrupt-parent = <&intc>;
		interrupts = <72>;
	};
};
```

#### Компиляция дерева устройств
Начальному загрузчику и ядру необходимо двоичное представление дерева устройств, поэтому исходный файл необходимо обработать компилятором dtc. В резуьтате получается файл с расширением .dtb, который называется двоичным деревом устройств.
Компилятор dtc находится в каталоге scripts/dtc/dtc исходного кода Linux, а также включен в виде пакета во многие дистрибутивы Linux.