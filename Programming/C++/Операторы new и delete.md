---
—Å–æ–∑–¥–∞–ª –∑–∞–º–µ—Ç–∫—É: 22-04-2025
tags:
  - –ü–ª—é—Å—ã
---
### –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ **–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ C++**.  
–†–∞–±–æ—Ç–∞—é—Ç **–≤–º–µ—Å—Ç–æ** `malloc()` –∏ `free()` –∏–∑ —è–∑—ã–∫–∞ C, **–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—é—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã**.

–ü—Ä–∏–º–µ—Ä:
```cpp
int* p = new int(10);      // –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ + –≤—ã–∑–æ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
delete p;                  // –≤—ã–∑–æ–≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ + –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
```
```cpp
MyClass* obj = new MyClass(); // new –≤—ã–∑—ã–≤–∞–µ—Ç MyClass::MyClass()
delete obj;                   // –≤—ã–∑—ã–≤–∞–µ—Ç ~MyClass()
```
### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç `new` –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?
1. –í—ã–∑—ã–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π (–∏–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π) `operator new()`
2. –ü–æ–ª—É—á–∞–µ—Ç `void*` ‚Äî –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏
3. –ö–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç —Å –ø–æ–º–æ—â—å—é **placement new**: `new(ptr) Type(...)`

### ## –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ `new` –∏ `delete` ‚Äî **–≤–æ–∑–º–æ–∂–Ω–∞ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∞**.
```cpp
class MyClass {
public:
    static void* operator new(std::size_t size) {
        std::cout << "Custom new: " << size << " bytes\n";
        return std::malloc(size);
    }

    static void operator delete(void* ptr) {
        std::cout << "Custom delete\n";
        std::free(ptr);
    }
};
```

### –ó–∞—á–µ–º –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å `new/delete`?
|–ü—Ä–∏—á–∏–Ω–∞|–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è|
|---|---|
|üíæ –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–ª–ª–æ–∫–∞—Ü–∏–∏|–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `memory pool`, `arena`|
|üß™ –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ|–°—á—ë—Ç—á–∏–∫–∏, —Ç—Ä–µ–∫ —É—Ç–µ—á–µ–∫|
|üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É–¥–∏—Ç|–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü, zeroing|
|‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è|–ë—ã—Å—Ç—Ä–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ–¥ –∑–∞–¥–∞—á–∏
## –í–∞–∂–Ω–æ:

- **–ù–µ–ª—å–∑—è –∑–∞–±—ã—Ç—å `delete[]` –ø—Ä–∏ `new[]`** ‚Äî –∏–Ω–∞—á–µ –±—É–¥–µ—Ç UB
- **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∏–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Å–∞**
- –í **–Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö** –≤–º–µ—Å—Ç–æ raw `new` –∏ `delete` —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
    - `std::make_unique`, `std::unique_ptr`
    - `std::make_shared`, `std::shared_ptr`

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ `new` –Ω–µ –º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å?

> üî• –ï—Å–ª–∏ `operator new` –Ω–µ –º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—Ö–≤–∞—Ç–∫–∞ –û–ó–£),  
> –æ–Ω **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—Ä–æ—Å–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ** —Ç–∏–ø–∞:
> üéØ **`std::bad_alloc`** (–∏–∑ `<new>`)

–ü—Ä–∏–º–µ—Ä:
```cpp
try {
    int* arr = new int[1'000'000'000]; // –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π –º–∞—Å—Å–∏–≤
} catch (const std::bad_alloc& e) {
    std::cerr << "–ü–∞–º—è—Ç—å –Ω–µ –≤—ã–¥–µ–ª–µ–Ω–∞: " << e.what() << '\n';
}
```
- `std::bad_alloc` ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ**, –∫–æ—Ç–æ—Ä–æ–µ `new` –±—Ä–æ—Å–∞–µ—Ç –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É
- –ï—Å–ª–∏ —Ç—ã **–Ω–µ –æ—Ç–ª–æ–≤–∏—à—å –µ–≥–æ** ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —á–µ—Ä–µ–∑ `std::terminate()`
### –ö–∞–∫ –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–¥–µ–ª–µ–Ω–∏–∏?
–ò—Å–ø–æ–ª—å–∑—É–π **not throwing –≤–µ—Ä—Å–∏—é `new`**:
```cpp
#include <new>  // –¥–ª—è std::nothrow

int* arr = new(std::nothrow) int[1'000'000'000];
if (!arr) {
    std::cerr << "–ü–∞–º—è—Ç—å –Ω–µ –≤—ã–¥–µ–ª–µ–Ω–∞ (nothrow)\n";
}
```
### –≠—Ç–æ –¥–µ–ª–∞–µ—Ç:
- **–ù–µ –±—Ä–æ—Å–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ** –ø—Ä–∏ –æ—à–∏–±–∫–µ
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nullptr`**, –µ—Å–ª–∏ –ø–∞–º—è—Ç–∏ –Ω–µ—Ç
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è `new`, `new[]`, –∏ –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤

|–§–æ—Ä–º–∞ `new`|–ü—Ä–∏ –æ—à–∏–±–∫–µ|
|---|---|
|`new Type`|‚ùå –±—Ä–æ—Å–∞–µ—Ç `std::bad_alloc`|
|`new(std::nothrow) Type`|‚úÖ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nullptr`|
### –†–µ–∑—é–º–µ
> `new` –∏ `delete` ‚Äî —ç—Ç–æ **–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –≤ C++*,  –≤—ã–∑—ã–≤–∞—é—â–∏–µ **–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã/–¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã** –∏ –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ **–ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏**.

üìå –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ `new/delete` –¥–∞—ë—Ç **–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∞–ª–ª–æ–∫–∞—Ü–∏–µ–π**, –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ **–∏–≥—Ä–æ–≤—ã—Ö –¥–≤–∏–∂–∫–∞—Ö, embedded, —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö –∏ STL.**

>–ï—Å–ª–∏ `new` –Ω–µ –º–æ–∂–µ—Ç –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å, –æ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–±—Ä–æ—Å–∞–µ—Ç `std::bad_alloc`**  –ß—Ç–æ–±—ã —ç—Ç–æ–≥–æ –∏–∑–±–µ–∂–∞—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π:  
`new(std::nothrow) Type` ‚Üí –æ–Ω –≤–µ—Ä–Ω—ë—Ç `nullptr`, –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.