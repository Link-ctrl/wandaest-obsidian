---
—Å–æ–∑–¥–∞–ª –∑–∞–º–µ—Ç–∫—É: 22-04-2025
tags:
  - –ü–ª—é—Å—ã
---
### –û–ø–∏—Å–∞–Ω–∏–µ
**vtable (virtual table)** ‚Äî —ç—Ç–æ **—Ç–∞–±–ª–∏—Ü–∞ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**,  
–∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–≥–∞–µ—Ç C++ **—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**.

> üí¨ –ï—Å–ª–∏ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å `obj->foo()`, –∏ `foo` ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è,  
> —Ç–æ **–≤—ã–±–æ—Ä –Ω—É–∂–Ω–æ–π –≤–µ—Ä—Å–∏–∏** (`Base::foo` –∏–ª–∏ `Derived::foo`) –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **vtable**.

### –î–ª—è —á–µ–≥–æ –Ω—É–∂–Ω–∞ vtable?
- ‚úÖ –ß—Ç–æ–±—ã **–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–∞–ª—å–Ω–æ –≤—ã–∑–≤–∞—Ç—å**, –µ—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —á–µ—Ä–µ–∑ **—É–∫–∞–∑–∞—Ç–µ–ª—å/—Å—Å—ã–ª–∫—É –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å**
- ‚úÖ –ß—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **runtime-–ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º**
- ‚úÖ –ß—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å `virtual`, `override`, `final`, –∏ `dynamic_cast`

–ü—Ä–∏–º–µ—Ä:
```cpp
class Base {
public:
    virtual void hello() { std::cout << "Base\n"; }
};

class Derived : public Base {
public:
    void hello() override { std::cout << "Derived\n"; }
};

void greet(Base* b) {
    b->hello();  // –ß—Ç–æ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–æ?
}
```
–û—Ç–≤–µ—Ç: **–µ—Å–ª–∏ `b` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ `Derived`**, —Ç–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è `Derived::hello()`.

‚û°Ô∏è –≠—Ç–æ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è **—á–µ—Ä–µ–∑ vtable**: –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å–æ–∑–¥–∞—ë—Ç **—Ç–∞–±–ª–∏—Ü—É —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏** –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—É—é.

| –§–∞–∫—Ç                                        | –ó–Ω–∞—á–µ–Ω–∏–µ                          |
| ------------------------------------------- | --------------------------------- |
| vtable —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ **–∫–ª–∞—Å—Å**, –Ω–µ –Ω–∞ –æ–±—ä–µ–∫—Ç | –û–¥–∏–Ω –Ω–∞ `Base`, –æ–¥–∏–Ω –Ω–∞ `Derived` |
| vptr ‚Äî —ç—Ç–æ **—Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –≤ –æ–±—ä–µ–∫—Ç–µ**       | –û–±—ã—á–Ω–æ –ø–µ—Ä–≤—ã–π —á–ª–µ–Ω (—É GCC/Clang)  |
| –ï—Å–ª–∏ –Ω–µ—Ç `virtual` ‚Äî **vtable –Ω–µ—Ç**         | –ë–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—Å—ë —Å—Ç–∞—Ç–∏—á–Ω–æ    |
| –¢–æ–ª—å–∫–æ **–ø–µ—Ä–≤—ã–µ 8 –±–∞–π—Ç** –Ω—É–∂–Ω—ã –¥–ª—è vptr     | –ù–∞ 64-–±–∏—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ              |
### –í–∞–∂–Ω–æ:
- **vtable —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º** ‚Äî —Ç—ã –µ—ë –Ω–µ –ø–∏—à–µ—à—å –≤—Ä—É—á–Ω—É—é
- –û–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤**
- **–§—É–Ω–∫—Ü–∏–∏ –Ω–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ ‚Üí –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é (–Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏)**
### –†–µ–∑—é–º–µ
> **vtable ‚Äî —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã**,  
> –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç C++ **–≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**,  **–¥–∞–∂–µ –µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å**.

üìå –ë–µ–∑ –Ω–µ—ë **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω**.