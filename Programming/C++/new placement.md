---
—Å–æ–∑–¥–∞–ª –∑–∞–º–µ—Ç–∫—É: 22-04-2025
tags:
  - –ü–ª—é—Å—ã
---
### –û–ø–∏—Å–∞–Ω–∏–µ
**Placement new** ‚Äî —ç—Ç–æ —Ñ–æ—Ä–º–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `new`, –∫–æ—Ç–æ—Ä–∞—è **—Ä–∞–∑–º–µ—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ —É–∂–µ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏**, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã **–∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–æ–≤—É—é –ø–∞–º—è—Ç—å —É –û–°/–∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞**.

> üí¨ –¢—ã **—Å–∞–º –≤—ã–¥–µ–ª—è–µ—à—å –ø–∞–º—è—Ç—å**, –∞ `placement new` –ø—Ä–æ—Å—Ç–æ **–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ –Ω—É–∂–Ω–æ–º—É –∞–¥—Ä–µ—Å—É**.

–°–∏–Ω—Ç–∞–∫—Å–∏—Å:
```cpp
void* mem = std::malloc(sizeof(MyClass));
MyClass* obj = new (mem) MyClass(42);  // ‚Üê placement new
```
–ó–¥–µ—Å—å:
- `std::malloc` –≤—ã–¥–µ–ª—è–µ—Ç "—Å—ã—Ä—É—é" –ø–∞–º—è—Ç—å
- `new (mem)` –≤—ã–∑—ã–≤–∞–µ—Ç **–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞** –ø—Ä—è–º–æ –ø–æ –∞–¥—Ä–µ—Å—É `mem`
### –ü—Ä–∏–º–µ—Ä –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:
```cpp
#include <iostream>
#include <new>     // –¥–ª—è placement new
#include <cstdlib> // malloc/free

struct MyClass {
    MyClass(int x) { std::cout << "Construct: " << x << "\n"; }
    ~MyClass()     { std::cout << "Destruct\n"; }
};

int main() {
    void* mem = std::malloc(sizeof(MyClass));

    MyClass* obj = new (mem) MyClass(123); // üëà placement new
    obj->~MyClass();                       // üëà —Ä—É—á–Ω–æ–π –≤—ã–∑–æ–≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

    std::free(mem);                        // üëà –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
}
```
–í—ã–≤–æ–¥:
```cpp
Construct: 123
Destruct
```

### –ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å placement new?
|–ü—Ä–∏—á–∏–Ω–∞|–ü—Ä–∏–º–µ—Ä|
|---|---|
|‚ö° –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å|Embedded, —è–¥—Ä–∞ –û–°, –¥—Ä–∞–π–≤–µ—Ä—ã|
|üíæ –í—ã–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ –±–ª–æ–∫–∞|–ü—É–ª –æ–±—ä–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –±—É—Ñ–µ—Ä–∞|
|‚ôªÔ∏è –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ|–ë–µ–∑ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö `new/delete`|
|üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–æ–≥–∏–∫–∞|–ö–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å/—É–Ω–∏—á—Ç–æ–∂–∞—Ç—å –≤—Ä—É—á–Ω—É—é|
### –û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ placement new:
- **–°–∞–º –≤—ã–¥–µ–ª—è–µ—à—å –ø–∞–º—è—Ç—å** (—á–µ—Ä–µ–∑ `malloc`, `std::aligned_storage`, `char buffer[]`)
- **–°–∞–º –≤—ã–∑—ã–≤–∞–µ—à—å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä**
- **–°–∞–º –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—à—å –ø–∞–º—è—Ç—å**, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `malloc`
- **–°–ª–µ–¥–∏—à—å –∑–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º** (alignment)

### –†–µ–∑—é–º–µ
==> **Placement new** ‚Äî —ç—Ç–æ —Ñ–æ—Ä–º–∞ `new`, –∫–æ—Ç–æ—Ä–∞—è **–Ω–µ –∞–ª–ª–æ—Ü–∏—Ä—É–µ—Ç –ø–∞–º—è—Ç—å**,  
> –∞ –ø—Ä–æ—Å—Ç–æ **–∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç –ø–æ —Ç–≤–æ–µ–º—É –∞–¥—Ä–µ—Å—É**.

üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–º, –≥–¥–µ –Ω—É–∂–µ–Ω **—Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ –∏ –ø–∞–º—è—Ç—å—é** ‚Äî  –≤ high-perf, embedded, custom allocators, –ø—É–ª–∞—Ö, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö STL.