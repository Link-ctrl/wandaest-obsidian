---
—Å–æ–∑–¥–∞–ª –∑–∞–º–µ—Ç–∫—É: 20-04-2025
tags:
  - –ü–ª—é—Å—ã
---
### –û–ø–∏—Å–∞–Ω–∏–µ
**RTTI (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤ C++, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π **—É–∑–Ω–∞–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ–±—ä–µ–∫—Ç–æ–≤** –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—à—å —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª—å –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å.
### –ö–æ–≥–¥–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ?
–ö–æ–≥–¥–∞ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å —Å **–ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–æ–º** (—Ç.–µ. —á–µ—Ä–µ–∑ `Base*`, `Base&`)  
–∏ —Ö–æ—á–µ—à—å –ø–æ–Ω—è—Ç—å ‚Äî **–∫ –∫–∞–∫–æ–º—É –∏–º–µ–Ω–Ω–æ `Derived` –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–±—ä–µ–∫—Ç?**
### 2 –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ RTTI –≤ C++

| –§—É–Ω–∫—Ü–∏—è                | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                                                                         |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------ |
| `typeid(obj)`          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ (—á–µ—Ä–µ–∑ `std::type_info`)                                                                    |
| `dynamic_cast<T>(ptr)` | –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–∏–ø—É T, **–µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞**, –∏–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nullptr` –∏–ª–∏ –∫–∏–¥–∞–µ—Ç `std::bad_cast` |
|                        |                                                                                                                    |
### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `typeid`: 
```cpp
#include <iostream>
#include <typeinfo>

class Animal { virtual void foo() {} };
class Dog : public Animal {};
class Cat : public Animal {};

int main() {
    Animal* a = new Dog;

    std::cout << typeid(*a).name() << "\n";  // ‚Üí Dog (–∏–ª–∏ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ "class Dog")
}

```
### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `dynamic_cast`
```cpp
Animal* a = new Dog;

if (Dog* d = dynamic_cast<Dog*>(a)) {
    std::cout << "–≠—Ç–æ —Å–æ–±–∞–∫–∞\n";
} else {
    std::cout << "–≠—Ç–æ –Ω–µ —Å–æ–±–∞–∫–∞\n";
}
```
### –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã RTTI:
1. –ö–ª–∞—Å—Å **–¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É `virtual` —Ñ—É–Ω–∫—Ü–∏—é**  
    (–∏–Ω–∞—á–µ **–Ω–µ—Ç vtable**, –∏ RTTI **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**)
2. RTTI **–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞** —Ñ–ª–∞–≥–∞–º–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:
    - `-fno-rtti` –≤ GCC/Clang
    - `/GR-` –≤ MSVC
### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RTTI?
|–õ—É—á—à–µ –∏–∑–±–µ–≥–∞—Ç—å üõë|–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å üëç|
|---|---|
|–í –≥–æ—Ä—è—á–µ–º –∫–æ–¥–µ (RTTI –º–µ–¥–ª–µ–Ω–Ω—ã–π)|–î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Ç–ª–∞–¥–∫–∏, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏|
|–í–º–µ—Å—Ç–æ virtual —Ñ—É–Ω–∫—Ü–∏–π|–ï—Å–ª–∏ –∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –æ–±—â–∞—è|
|–¢–∞–º, –≥–¥–µ –º–æ–∂–Ω–æ —à–∞–±–ª–æ–Ω—ã|–ü—Ä–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º –ø–ª–∞–≥–∏–Ω–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏|
### –†–µ–∑—é–º–µ
> RTTI ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç:
> - ‚úÖ –£–∑–Ω–∞—Ç—å **—Ä–µ–∞–ª—å–Ω—ã–π —Ç–∏–ø** –æ–±—ä–µ–∫—Ç–∞: `typeid`
> - ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ —Ç–∏–ø: `dynamic_cast`
–ù–æ:
- –¢–æ–ª—å–∫–æ –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ (–Ω–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π ‚Äî —ç—Ç–æ –∫–æ—Å—Ç—ã–ª—å, –∞ –Ω–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)